CREATE OR REPLACE ROLE player;

GRANT USAGE ON WAREHOUSE compute_wh TO ROLE player;
GRANT USAGE ON DATABASE DW_IPL TO ROLE player;
GRANT USAGE ON SCHEMA IPL_ETL TO ROLE player;
--GRANT SELECT ON TABLE dim_teams TO ROLE player;
GRANT SELECT ON ALL TABLES IN SCHEMA IPL_ETL TO ROLE player;

GRANT ROLE player TO USER NIKHILKUMAR;

USE ROLE ACCOUNTADMIN;
ALTER TABLE IF EXISTS dim_teams MODIFY COLUMN owner UNSET MASKING POLICY;

--------------------
CREATE OR REPLACE MASKING POLICY mask_owner AS (val STRING) RETURNS STRING ->
  CASE
    WHEN CURRENT_ROLE() IN ('PLAYER') THEN
      REGEXP_REPLACE(val, '\\b(\\w)\\w*(\\w)\\b', '\\1***\\2', 1, 0, 'i')
  END;
--------------------

ALTER TABLE IF EXISTS dim_teams MODIFY COLUMN owner SET MASKING POLICY mask_owner;
USE ROLE player;
SELECT * FROM dim_teams;




